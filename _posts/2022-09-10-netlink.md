---
layout: post  
title: 搞定锐捷认证，享受智能生活
categories: 笔记
tags: 锐捷 米家
author: Ko_teiru
---

* content
{:toc}

> 上个月月底开学，搬入新校区，得知大二时使用的家庭宽带业务已经不提供服务了，取而代之的是统一的校园网服务。  
> 没办法，用不了总不能不用吧，加点钱继续整了个半年的校园网套餐，毕竟不知道什么时候就会走。办理时悄悄询问了一下营业厅的工作人员，问这次使用的校园网供应商。  
> 结果被说是华为的，我还寻思华为啥时候开始搞校园网业务了。回去一看和大一那会一样，依旧使用的是锐捷的校园网认证方案，只不过改成了电脑端手机端统一使用的网页认证罢了（认证网页连学校 logo 还没加上，笑死我了）。





### 准备
要搞定锐捷认证，必须请出我们的老朋友———MentoHUST 了。  
不过和大一那会还是用别人刷好的带 MentoHUST 的硬路由来上网的，稳定性实在不敢恭维。大二之后开始捣鼓软路由的我必定选择扩展性更好的软路由来实现这个操作了。  
这次使用的软路由是咸鱼收的二手 R4S，虽然是二手但是还是好贵，真的是理财产品了。不过校园网那小水管，即使是 R2S 的性能也绰绰有余了。买这个属于是从长远的角度考虑了。  
固件依旧是使用的自己编译的 [lean 的 OpenWrt 固件](https://github.com/coolsnowwolf/openwrt)，而 MentoHUST 也使用的是支持 OpenWrt 的包（[这里](https://github.com/KyleRicardo/MentoHUST-OpenWrt-ipk)）。  
虽然这个软件没有 luci 界面，不过用 ssh 的方式进行操作也是没有任何问题的。（指写个 sh 脚本加入启动项，开机自己启动。断线重播之类的功能软件本身就自带了）

#### R2S、R4S编译需要注意的事项
编译的时候，`Target System` 直接选择 `Rockchip`，`Subtarget` 选择 `RK33xx/RK35xx boards（64 bit）`。

`Target profile` 请根据软路由型号选择，例如 R4S 就选择 `FriendlyARM NanoPi R4S`（重点在后面的**NanoPi R?S**)

编译输出选项中请取消 `ext4` 的勾选，选择此项可能导致编译失败。另外本人依旧比较推荐勾选 `tar.gz`，编译完成后将压缩包复制到电脑上再解压写入，可以有效保证固件完整性。（要说的话就是直接编译出来的 `img` 文件次次写入都有一部分报错，虽然好像不影响使用不够看着不舒服）  

### 执行

首先把宿舍室内交换机的线接入软路由的 wan 口（交换机在室内的弱电箱内），OpenWRT内 lan 口的通讯方式不用改，使用默认的 DHCP 就行。连接上了之后先修改一下 `/etc/mentohust.conf`。把除了用户名和密码的其余配置项配置好。  
当然，有些用不到的配置项也不用非得填，比如固定 IP 那玩意就是不用就不用填。
> 这里不填用户名密码是因为这里的密码可能是加密后了的，明文写入会直接报密码错误，然后我这校园网的反馈信息又是 GBK 编码的。。  
> 导致我在 ssh 里看见的都是一堆乱码，把 log 拷贝下来才发现问题所在。后面尝试使用指令带入的密码成功认证。  
> 至于认证方式应该先试试锐捷，DHCP的话一个个试吧，连不上 `mentohust -k` 就完事了

配置好之后用指令测试一下是否能够成功认证，并且观察报错信息进行排错。*如果发现输出消息乱码，请把消息输出方式改为输出至文件，并把日志文件下载到电脑上进行查看*  
`mentohust -u校园网账户 -p校园网密码`  
不出意外的话就不出意外认证成功了，软路由的 lan 口连接的设备（你的电脑）应该能免认证上网了。  
像R2S、R4S之类的双网口设备建议 lan 口接个硬路由，然后把路由设置问有线桥接模式，这下所有的数据啥的全权交给软路由处理，硬路由单纯承担交换无线数据用。  
至于其他的东西就懒得说了，比如 DNS加速 和一堆奇奇怪怪的东西啥的啊，能上网就行了。


### 总结
R4S 花了 400+，硬路由是小米的 AX3000 移动定制版花了100+，校园网花了200-。虽然看着花了挺多钱，不过要是按学校一人一网来算的话还是给舍友们省了不少钱的。虽然根本也没叫他们交钱就是了，本来呆这的时间也没多久，好好珍惜大学生活吧，笑死。  
主要的话是宿舍有网了我的米家设备才能用，本质还是为了自己舒服方便罢了。谁不想下课前20分钟就把寝室空调打开呢？  
另外虽然这篇小作文就30来行，不过当时捣鼓可废了我不少劲，没办法，老年痴呆了，这些东西不记录一下以后真想不起来了。  
另外之前挖的编译 OpenWrt 的坑也没填完，倒是没想到这个先写出来了，继续笑死